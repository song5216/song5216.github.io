---
title: "凤凰架构"
date: 2026-02-18T21:47:50+08:00
draft: true
tags: ["架构"]
categories: []
description: ""
cover:
    image: ""
    alt: ""
    caption: ""
    relative: false
---

## 类库与服务

服务化的目标，是把系统拆分为可以**独立演进、独立部署、独立自治**的组件；而类库/模块化更多是**代码层面的复用与拆分**。

两者的关键差异在于：

- **类库调用发生在进程内**：接口调用通过编译期静态链接与运行期地址引用完成，本质上是一次本地函数调用，不涉及网络传输。
- **服务调用跨进程/跨主机**：接口调用需要序列化与网络传输，必须面对延迟、失败、重试、超时等分布式问题。

因此：

- **类库升级通常需要重新编译并发布应用整体**。
- **服务可以独立升级与发布**，调用方通过契约（接口/协议）进行解耦。

## 服务化需要解决的三类基础问题

当系统走向服务化，最先要补齐的是三类基础能力：**服务发现、网关路由、负载均衡**。

- **服务发现**：调用方如何获知“被调用服务在哪里”。
- **网关/路由**：请求如何抵达正确的服务实例，以及如何做统一入口治理（鉴权、限流、灰度等）。
- **负载均衡**：当存在多个等价实例时，如何在它们之间分摊请求。

## 服务发现

### 标识方式

一个服务实例通常由 **主机标识（域名/IP）+ 端口** 唯一确定。

最简单的服务发现方式是 **DNS**：将域名解析为 IP（并可能返回多个地址），客户端再结合端口完成访问。

当系统需要支持**实例上下线、故障切换、扩缩容、重启**等动态变化时，通常需要更强的注册与发现机制，让调用方能够及时感知实例变化。

### 注册中心的可用与可靠

- **可用（Availability）**：注册中心本身功能是否可用、能否持续对外提供查询与注册能力。
- **可靠（Reliability）**：注册的服务数据是否准确、一致，能否避免“脏数据”导致的错误路由。

常见保障手段：

- **高可用**：多副本部署、故障转移。
- **一致性**：通过一致性协议（如 Paxos/Raft）保证数据一致。

### 注册中心的常见实现

1. 基于分布式 K/V 存储或协调系统构建，例如 `ZooKeeper`。
2. 专用的服务发现/注册中心产品或组件，例如 `Eureka`、`Consul`、`Nacos`。
3. 基于基础设施能力实现，例如 `DNS`（更轻量，但动态能力相对有限）。

## 网关/路由的三种常见模式

1. **统一网关路由**：网关作为独立组件对外提供统一入口（天然跨网络调用）。
2. **客户端路由**：路由逻辑在客户端/SDK 中完成（通常与调用方进程内集成）。
3. **边车路由（Sidecar）**：以边车形式部署（例如在 K8s 体系中），从控制面获取服务与路由配置并执行转发。
